name: tank-ci
on: workflow_dispatch
# on:
#   push:
#     branches:
#     - main
env:
  OSD_TARGET_BOARD: arduino:avr:nano
  TANK_TARGET_BOARD: arduino:avr:mega
  PANEL_CONTROL_TARGET_BOARD: arduino:avr:mega
  ARDUINO_CLI_LIBRARIES_DIR: /home/runner/Arduino/libraries

jobs:
  compile_modules:
    name: Compiles all modules
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository code
        uses: actions/checkout@v4
      # - name: "Install Arduino CLI" 
      #   run: |
      #     curl -fsSL https://raw.githubusercontent.com/arduino/arduino-cli/master/install.sh | BINDIR=/usr/local/bin sh
      #     arduino-cli core install arduino:avr
          
      # - name: Install Libraries
      #   run: | 
      #     arduino-cli lib install RadioHead PWMServo "Adafruit SSD1306"
      #     sed -i 's!//#define RH_ENABLE_ENCRYPTION_MODULE!#define RH_ENABLE_ENCRYPTION_MODULE!' $ARDUINO_CLI_LIBRARIES_DIR/RadioHead/RadioHead.h
      #     cd $ARDUINO_CLI_LIBRARIES_DIR && git clone https://github.com/kostko/arduino-crypto.git
        
      # - name: Compiler platform/OSD module
      #   run: arduino-cli compile -b $OSD_TARGET_BOARD -e ./platform/osd

      # - name: Compiler platform/receiver
      #   run: arduino-cli compile -b $TANK_TARGET_BOARD -e ./platform/receiver

      # - name: Compiler remote-panel-control
      #   run: arduino-cli compile -b $PANEL_CONTROL_TARGET_BOARD -e ./remote-panel-control/Code
  static_tests:
    name: Run Static Tests
    runs-on: ubuntu-latest
    needs: compile_modules
    steps:
     - name: SonarCloud Scan
       uses: sonarsource/sonarcloud-github-action@master
     
